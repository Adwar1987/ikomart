(function($){var product_box_container_class=".product-box-container";var max_value=[];var availability=[];var is_pre_order=[];$.each($(product_box_container_class),function(index,value){uuid=$(this).data('uuid');availability[uuid]=$(this).find('.qty-container').data('availability-type');is_pre_order[uuid]=$(this).find('.qty-container').data('is-pre-order');if(availability[uuid]=='limited_stock'&&is_pre_order[uuid]!=1){max_value[uuid]=$(this).find('.qty-container').data('qty-max');}else{max_value[uuid]=999;}
if($(this).find('.qty-container').find('.qty-number').val()==max_value[uuid]){$(this).find('.qty-container').find('.qty-plus').attr('disabled',true);}});if($(product_box_container_class).length>0){$(product_box_container_class+'[data-type="perishable"]').each(function(key,index){var product_uuid=$(this).data('uuid');$.ajax({url:'/utils/get_holidays?product_uuid='+product_uuid,dataType:'json',type:'get',context:$(this),error:function(){console.log('error');},success:function(responses){var forbidden=responses;$(this).find('.datepicker').datepicker({format:'dd/mm/yyyy',keyboardNavigation:false,autoclose:true,orientation:'auto right',beforeShowDay:function(Date){var year=Date.getFullYear();var month=(1+Date.getMonth()).toString();month=month.length>1?month:'0'+month;var day=Date.getDate().toString();day=day.length>1?day:'0'+day;var curr_date=day+'/'+month+'/'+year;if(forbidden.indexOf(curr_date)>-1)return false;}}).on('changeDate',function(event){checkProductInCart(event);});;}});});$(product_box_container_class+' .buy').click(function(e){showLoading($(this).closest(product_box_container_class));var uuid=$(this).parents('.product-box-container').data('uuid');addToCart(e,true,1,function(response){max_value[uuid]=response.data.product.quantity;});});$(product_box_container_class+' .qty-container').on('click','.qty-plus',function(e){var plus_qty=$(e.delegateTarget).data('step');updateCart(e,true,plus_qty);});$(product_box_container_class+' .qty-container').on('click','.qty-min',function(e){var minus_qty=-($(e.delegateTarget).data('step'));var input=$(this).closest(product_box_container_class).find('input[name=order_qty]');if(input.val()==1){input.val(parseInt(input.val())+minus_qty);}
updateCart(e,false,minus_qty);});$(product_box_container_class+' .qty-container').keyup(function(e){var uuid=$(this).parents('.product-box-container').data('uuid');if(e.keyCode==13){document.activeElement.blur();}});$(product_box_container_class+' .qty-container').on('change','.qty-number',function(e){var past_qty=$(this).closest(product_box_container_class).find('input[name=last_qty]').val();var step=$(this).val()-past_qty;if($(this).val()>0){$(this).val(past_qty);}
if($(this).val()==""){$(this).val("0");}
updateCart(e,false,step);});function checkProductInCart(event){var current_target=event.currentTarget;var that=$(current_target).closest(product_box_container_class);$.ajax({url:'/product/cart/check',dataType:'json',type:'post',context:$(that),data:{type:'perishable',product_uuid:$(that).data('uuid'),date:$(that).find('input[name=order_item_date]').val(),_token:$(that).find('input[name=_token]').val()},error:function(xhr,status,error){console.log(error);},beforeSend:function(){showLoading($(that));},success:function(response){if(response.status)
{if(response.data.in_cart){_change($(this),response.data.qty_in_cart);}
else{_reset($(this));}}
else
if(response.error!==null||response.error!="")
{GeneralMessage.animate_error_message(response.error);}},complete:function(){removeLoading($(that));}});}
function updateCart(event,is_animate_animation,step_qty){var current_target=event.currentTarget;var that=$(current_target).closest(product_box_container_class);var uuid=$(that).data('uuid');var past_qty=parseInt($(that).find('input[name=last_qty]').val());var curr_qty=parseInt($(that).find('input[name=order_qty]').val());if((curr_qty+step_qty)<=0){removeFromCart(event,step_qty);}
else{if((curr_qty)+step_qty>=max_value[uuid]){$(that).find('input[name=order_qty]').val(max_value[uuid]);}
addToCart(event,is_animate_animation,step_qty,function(response){max_value[uuid]=response.data.product.quantity;});}}
function removeFromCart(event,step_qty){var current_target=event.currentTarget;var that=$(current_target).closest(product_box_container_class);var past_qty=1;var input=$(this).closest(product_box_container_class).find('input[name=order_qty]');showLoading($(that));$.ajax({url:'/product/cart/remove',type:'post',context:$(that),data:{product_id:$(that).data('uuid'),product_type:$(that).data('type'),date:$(that).find('input[name=order_item_date]').val(),_token:$(that).find('input[name=_token]').val(),},error:function(xhr,status,error){console.log(error);},success:function(response){if(response['status']){removeLoading($(that));_update($(that),step_qty);animateCartWiggle();}
else{GeneralMessage.animate_error_message(response['message']);}}});}
function addToCart(event,is_animate_animation,step_qty,callback){var current_target=event.currentTarget;var that=$(current_target).closest(product_box_container_class);_update($(that),step_qty);var past_qty=$(that).find('input[name=last_qty]').val();var curr_qty=$(that).find('input[name=order_qty]').val();animateCartWiggle();$.ajax({url:'/product/cart/add-ajax',dataType:'json',type:'post',context:$(that),data:{order_item_product_uuid:$(that).data('uuid'),order_item_product_type:$(that).data('type'),order_item_date:$(that).find('input[name=order_item_date]').val(),order_qty:parseInt($(that).find('input[name=order_qty]').val()),_token:$(that).find('input[name=_token]').val()},error:function(xhr,status,error){console.log(error);},success:function(response){if(response.status)
{Moengage.track_event("CART_ADD",{"interface":"m-web","brand_name":response.data.product.merchant.name,"product_name":response.data.product.name,"product_id":response.data.product.id,"product_url":"https://www.lemonilo.com/product/"+response.data.product.slug,"product_sku":response.data.product.sku,"product_price":response.data.product.sell_price,"product_image_url":"https://lemonilo.imgix.net/"+response.data.product.photo_url,"sub_category_name":response.data.product.subcategory.name,"sub_category_id":response.data.product.subcategory.id,"sub_category_url":window.location.origin+"/"+response.data.product.category.slug+"/"+response.data.product.subcategory.slug,"category_name":response.data.product.category.name,"category_id":response.data.product.category.id,"category_url":window.location.origin+"/"+response.data.product.category.slug,"super_category_name":response.data.product.super_category.name,"super_category_id":response.data.product.super_category.id,});updateLastValue($(this));if(callback){callback(response);}
if($(current_target).is('.buy')){notificationCartPopover();}}
else
if(response.error!==null||response.error!="")
{if(response.is_available==0){$(that).find('.sold-overlay').removeClass('hidden');str_html="<div class=''><a href='javascript:void(0);' class='yellow inverted rectangular ui fluid button p-lr-5 disabled-link' style='white-space: normal;'>Stok Kosong</a></div>"
$(that).find('.product-box-action-container').html(str_html);updateTotalProductInCartUi(-curr_qty);}
GeneralMessage.animate_error_message(response.error);}},complete:function(){if(parseInt(curr_qty)==1){removeLoading(that);}}});}
function _reset(box_element){var before_reset_value=$(box_element).find('input[name=order_qty]').val();updateValue(box_element,before_reset_value,0);changeUi(box_element);}
function _change(box_element,change_value){updateValue(box_element,change_value,change_value);changeUi(box_element);}
function _update(box_element,step){var min_value=parseInt($(box_element).find('.qty-container').data('qty-min'));var uuid=$(box_element).data('uuid');var past_qty=parseInt($(box_element).find('input[name=last_qty]').val());var curr_qty=parseInt($(box_element).find('input[name=order_qty]').val())+parseInt(step);if(curr_qty<min_value){curr_qty=min_value;}
else if(curr_qty>=max_value[uuid]){curr_qty=max_value[uuid];step=curr_qty-past_qty;}
updateValue(box_element,past_qty,curr_qty);refreshUi(box_element,step);}
function updateLastValue(box_element){var curr_qty=parseInt($(box_element).find('input[name=order_qty]').val());var past_qty=curr_qty;updateValue(box_element,past_qty,curr_qty);}
function updateValue(box_element,before_qty,update_qty){$(box_element).find('input[name=last_qty]').val(before_qty);$(box_element).find('input[name=order_qty]').val(update_qty);}
function changeUi(box_element){changeButtonAction(box_element);}
function refreshUi(box_element,step){changeButtonAction(box_element);refreshQuantityUi(box_element);updateTotalProductInCartUi(step);}
function updateTotalProductInCartUi(update_step_qty)
{var curr_cart_qty=parseInt($('.header-nav .cart-container input[name=cur_qty]').val());var now_qty=curr_cart_qty+update_step_qty;$('.header-nav .cart-container input[name=cur_qty]').val(now_qty);$('.header-nav .cart-container .cart-sum').html(now_qty>99?'99+':now_qty);}
function changeButtonAction(box_element){var past_qty=parseInt($(box_element).find('input[name=last_qty]').val());var curr_qty=parseInt($(box_element).find('input[name=order_qty]').val());if(curr_qty>=1){changeToProductInCartUI(box_element);}
else{changeToProductNotInCartUI(box_element);}}
function refreshQuantityUi(box_element){var qty=parseInt($(box_element).find('input[name=order_qty]').val());var uuid=$(box_element).data('uuid');if(qty<=0){$(box_element).find('.qty-container .qty-min').attr('disabled','disabled');}
else{$(box_element).find('.qty-container .qty-min').removeAttr('disabled');}
if(qty>=max_value[uuid]){$(box_element).find('.qty-container .qty-plus').attr('disabled','disabled');}
else{$(box_element).find('.qty-container .qty-plus').removeAttr('disabled');}}
function changeToProductInCartUI(box_element){$(box_element).find('.buy-container').addClass('hidden');$(box_element).find('.qty-container').removeClass('hidden');}
function changeToProductNotInCartUI(box_element){$(box_element).find('.buy-container').removeClass('hidden');$(box_element).find('.qty-container').addClass('hidden');}
function notificationCartPopover(){$('.cart-popover').webuiPopover('destroy');WebuiPopovers.show('.cart-popover',{width:300,placement:'bottom-left',autoHide:2000,});}
function showMessageModal(box_element,message){if(!$('#remove-product-modal').is(':visible')){$('.modal.modal-cart').modal({inverted:true,onShow:function(){var that=$(this);that.find('.cart-message').html(message);setTimeout(function(){that.modal('hide');},1500);}}).modal('show');$(".ui.modal.modal-cart").css("margin-top","-58px");}}
function showLoading(box_element){$(box_element).find('.loading-container').show();}
function removeLoading(box_element){$(box_element).find('.loading-container').hide();}
function animateCartWiggle(){var wiggle_elem=$(".icon-trolley");$(wiggle_elem).wiggle(2,100);}
jQuery.fn.wiggle=function(times,duration,easing,complete){var self=this;if(times>0){this.animate({marginLeft:times--%2===0?-15:15},duration,easing,function(){self.wiggle(times,duration,easing,complete);});}else{this.animate({marginLeft:0},duration,easing,function(){if(jQuery.isFunction(complete)){complete();}});}
return this;};}})(jQuery);